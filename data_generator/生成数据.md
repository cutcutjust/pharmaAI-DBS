# 数据生成策略详细说明

## 📋 总体要求

根据课程要求，数据库系统需要至少**10万条数据**，分布在8个核心表中。数据生成需要满足以下要求：

1. **数据规模**：总计约17万条记录，确保满足10万+的数据量要求
2. **数据关系**：正确维护表之间的外键关系（1-1、1-N、N-M）
3. **数据质量**：生成的数据应具有合理性和多样性，模拟真实业务场景
4. **生成顺序**：必须按照依赖关系顺序生成，先基础数据，后关联数据

---

## 🗂️ 数据生成顺序

数据生成必须严格按照以下顺序执行，确保外键依赖关系正确：

```
第一阶段：基础数据（无外键依赖）
  ↓
第二阶段：关联基础数据（依赖第一阶段）
  ↓
第三阶段：主要业务数据（依赖第一、二阶段）
  ↓
第四阶段：辅助业务数据（依赖第一、二、三阶段）
```

---

## 📊 第一阶段：基础数据生成

### 1. 药典条目表 (pharmacopoeia_items)

**目标数量**：约 6,000 条

**数据要求**：

- **卷号分布**：
  - 第一部（volume=1）：约 2,280 条（38%），包含药材和饮片、植物油脂和提取物、成方制剂和单味制剂
  - 第二部（volume=2）：约 2,760 条（46%），包含化学药品、抗生素、生化药品等
  - 第三部（volume=3）：约 360 条（6%），包含生物制品、疫苗、通则和指导原则
  - 第四部（volume=4）：约 600 条（10%），包含药用辅料、通则、指导原则
- **文档ID范围**：
  - 第一部：doc_id 从 49155 到 51433
  - 第二部：doc_id 从 51439 到 54215
  - 第三部：doc_id 从 54231 到 54599
  - 第四部：doc_id 从 54610 到 55469
- **字段要求**：
  - `name_cn`：中文名称，格式如"药典条目{doc_id}"或实际药品名称
  - `name_pinyin`：拼音名称，格式如"Yaodian Tiaoyue {doc_id}"
  - `name_en`：英文名称，格式如"Pharmacopoeia Item {doc_id}"
  - `category`：根据卷号分配相应分类（药材和饮片、化学药品、生物制品、药用辅料等）
  - `content`：详细内容描述，包含卷号、文档ID和类别信息
  - `volume` 和 `doc_id` 组合必须唯一

**字段存储格式详细说明**：

| 字段名          | SQL类型      | 是否必填 | 存储格式                        | 示例值                                 | 说明                        |
| --------------- | ------------ | -------- | ------------------------------- | -------------------------------------- | --------------------------- |
| `item_id`     | SERIAL       | 自动生成 | 整数，自动递增                  | 1, 2, 3...                             | 主键，插入时不需要提供      |
| `volume`      | INT          | 必填     | 整数，范围1-4                   | 1, 2, 3, 4                             | 药典卷号，必须为1/2/3/4之一 |
| `doc_id`      | INT          | 必填     | 整数，根据卷号范围              | 49155, 51439, 54231, 54610             | 文档ID，与volume组合唯一    |
| `name_cn`     | VARCHAR(200) | 必填     | 中文字符串，最大200字符         | "药典条目49155", "人参"                | 中文名称，不能为空          |
| `name_pinyin` | VARCHAR(200) | 可选     | 拼音字符串，最大200字符         | "Yaodian Tiaomu 49155", "Renshen"     | 拼音名称，可为NULL          |
| `name_en`     | VARCHAR(200) | 可选     | 英文字符串，最大200字符         | "Pharmacopoeia Item 49155", "Ginseng"  | 英文名称，可为NULL          |
| `category`    | VARCHAR(100) | 可选     | 中文字符串，最大100字符         | "药材和饮片", "化学药品"               | 分类信息，可为NULL          |
| `content`     | TEXT         | 可选     | 文本字符串，无长度限制          | "药典第1部 文档ID 49155 的详细内容..." | 详细内容，可为NULL          |
| `created_at`  | TIMESTAMP    | 自动生成 | 时间戳格式：YYYY-MM-DD HH:MM:SS | "2025-01-15 10:30:00"                  | 创建时间，默认当前时间      |

**SQL插入示例**：

```sql
INSERT INTO pharmacopoeia_items (volume, doc_id, name_cn, name_pinyin, name_en, category, content)
VALUES (1, 49155, '药典条目49155', 'Yaodian Tiaoyue 49155', 'Pharmacopoeia Item 49155', '药材和饮片', '药典第1部 文档ID 49155 的详细内容...');
```

**注意事项**：

- 这是所有其他表的外键引用源，必须首先生成
- 数据应覆盖四部药典的所有主要类别
- `volume` 和 `doc_id` 组合必须唯一，插入前需检查
- `item_id` 和 `created_at` 由数据库自动生成，无需手动设置

---

### 2. 药检员表 (inspectors)

**目标数量**：约 150 条

**数据要求**：

- **工号格式**：`YJ{年份}{序号}`，如 YJ2025001、YJ2024002
  - 年份范围：2020-2025
  - 序号：4位数字，从0001开始递增
- **姓名生成**：
  - 姓氏：从常见姓氏列表中随机选择（李、王、张、刘、陈等30个常见姓）
  - 名字：从常见名字列表中随机选择（伟、芳、娜、秀英、敏等50个常见名）
  - 组合成2-3字的中文姓名
- **部门分配**：从10个部门中随机分配
  - 质量控制部、药品检验科、中药鉴定室、药物分析室、微生物检验科
  - 仪器分析室、临床药理科、药品稳定性研究室、中成药检测科、特殊药品检验科
- **职称分配**：从10个职称中随机分配
  - 助理药师、药师、主管药师、副主任药师、主任药师
  - 检验员、高级检验员、检验师、高级检验师、首席检验师
- **资质等级**：从4个等级中随机分配（初级资质、中级资质、高级资质、专家级资质）
- **其他字段**：
  - `phone`：11位手机号，以1开头，第二位为3/5/7/8/9
  - `email`：格式为"{姓名}{数字}@yaodian.com"
  - `join_date`：入职日期，范围2015-2025年，随机生成
  - `is_active`：95%概率为在岗（TRUE），5%概率为非在岗（FALSE）

**字段存储格式详细说明**：

| 字段名                  | SQL类型      | 是否必填 | 存储格式                        | 示例值                       | 说明                           |
| ----------------------- | ------------ | -------- | ------------------------------- | ---------------------------- | ------------------------------ |
| `inspector_id`        | SERIAL       | 自动生成 | 整数，自动递增                  | 1, 2, 3...                   | 主键，插入时不需要提供         |
| `employee_no`         | VARCHAR(50)  | 必填     | 字符串，格式：YJ{年份}{4位序号} | "YJ2025001", "YJ2024002"     | 工号，必须唯一，最大50字符     |
| `name`                | VARCHAR(100) | 必填     | 中文字符串，2-3字姓名           | "张三", "李四", "王五"       | 姓名，不能为空，最大100字符    |
| `phone`               | VARCHAR(20)  | 可选     | 字符串，11位手机号              | "13812345678", "15987654321" | 电话，可为NULL，最大20字符     |
| `email`               | VARCHAR(100) | 可选     | 字符串，邮箱格式                | "zhangsan123@yaodian.com"    | 邮箱，可为NULL，最大100字符    |
| `department`          | VARCHAR(100) | 可选     | 中文字符串                      | "质量控制部", "药品检验科"   | 部门，可为NULL，最大100字符    |
| `title`               | VARCHAR(50)  | 可选     | 中文字符串                      | "药师", "主管药师", "检验师" | 职称，可为NULL，最大50字符     |
| `certification_level` | VARCHAR(50)  | 可选     | 中文字符串                      | "初级资质", "高级资质"       | 资质等级，可为NULL，最大50字符 |
| `join_date`           | DATE         | 可选     | 日期格式：YYYY-MM-DD            | "2020-03-15", "2023-07-20"   | 入职日期，可为NULL             |
| `is_active`           | BOOLEAN      | 可选     | 布尔值：TRUE/FALSE              | TRUE, FALSE                  | 是否在岗，默认TRUE             |
| `created_at`          | TIMESTAMP    | 自动生成 | 时间戳格式：YYYY-MM-DD HH:MM:SS | "2025-01-15 10:30:00"        | 创建时间，默认当前时间         |

**SQL插入示例**：

```sql
INSERT INTO inspectors (employee_no, name, phone, email, department, title, certification_level, join_date, is_active)
VALUES ('YJ2025001', '张三', '13812345678', 'zhangsan123@yaodian.com', '质量控制部', '药师', '中级资质', '2020-03-15', TRUE);
```

**注意事项**：

- `employee_no` 必须唯一，插入前需检查
- `inspector_id` 和 `created_at` 由数据库自动生成，无需手动设置
- 这些药检员将用于后续生成对话和实验数据

---

### 3. 实验室表 (laboratories)

**目标数量**：约 30 条

**数据要求**：

- **实验室代码格式**：`LAB{序号}`，如 LAB001、LAB002，序号3位数字
- **实验室名称**：格式为"{城市}{实验室类型}"
  - 城市：从15个城市中随机选择（北京、上海、广州、深圳、杭州等）
  - 实验室类型：从12种类型中随机选择
    - 物理特性检验室、化学成分分析室、药理活性检测室、微生物检验室
    - 稳定性研究室、制剂工艺研究室、分子生物实验室、色谱分析实验室
    - 光谱分析实验室、生物分析实验室、理化检测实验室、药物代谢研究室
- **地址格式**："{城市}市科技园区{1-20}号楼"
- **认证类型**：从8种认证中随机选择
  - ISO 17025、ISO 9001、GLP、CNAS、CMA、CAP
  - 国家药典委员会认证、药品检验机构资格认证
- **设备等级**：从5个等级中随机选择（基础级、标准级、先进级、研发级、国际领先级）

**字段存储格式详细说明**：

| 字段名              | SQL类型      | 是否必填 | 存储格式                                     | 示例值                                        | 说明                              |
| ------------------- | ------------ | -------- | -------------------------------------------- | --------------------------------------------- | --------------------------------- |
| `lab_id`          | SERIAL       | 自动生成 | 整数，自动递增                               | 1, 2, 3...                                    | 主键，插入时不需要提供            |
| `lab_code`        | VARCHAR(50)  | 必填     | 字符串，格式：LAB{3位序号}                   | "LAB001", "LAB002"                            | 实验室代码，必须唯一，最大50字符  |
| `lab_name`        | VARCHAR(200) | 必填     | 中文字符串，格式：{城市}{类型}               | "北京物理特性检验室", "上海化学成分分析室"    | 实验室名称，不能为空，最大200字符 |
| `location`        | VARCHAR(200) | 可选     | 中文字符串，格式：{城市}市科技园区{楼号}号楼 | "北京市科技园区5号楼", "上海市科技园区12号楼" | 地址，可为NULL，最大200字符       |
| `certification`   | VARCHAR(100) | 可选     | 字符串                                       | "ISO 17025", "CNAS", "GLP"                    | 认证类型，可为NULL，最大100字符   |
| `equipment_level` | VARCHAR(50)  | 可选     | 中文字符串                                   | "基础级", "标准级", "先进级"                  | 设备等级，可为NULL，最大50字符    |
| `created_at`      | TIMESTAMP    | 自动生成 | 时间戳格式：YYYY-MM-DD HH:MM:SS              | "2025-01-15 10:30:00"                         | 创建时间，默认当前时间            |

**SQL插入示例**：

```sql
INSERT INTO laboratories (lab_code, lab_name, location, certification, equipment_level)
VALUES ('LAB001', '北京物理特性检验室', '北京市科技园区5号楼', 'ISO 17025', '标准级');
```

**注意事项**：

- `lab_code` 必须唯一，插入前需检查
- `lab_id` 和 `created_at` 由数据库自动生成，无需手动设置
- 这些实验室将用于后续生成实验记录和权限关系

---

## 🔗 第二阶段：关联基础数据生成

### 4. 药检员-实验室访问权限关系表 (inspector_lab_access)

**目标数量**：约 800 条

**数据要求**：

- **关系生成策略**：
  - 从已生成的药检员和实验室中随机组合
  - 确保每个组合唯一（一个药检员对一个实验室只有一条记录）
  - 一个药检员可以访问多个实验室（N-M关系）
  - 一个实验室可以被多个药检员访问
- **权限级别**：从4个级别中随机分配
  - 只读权限、操作权限、管理权限、完全权限
- **授权日期**：范围2018-2025年，随机生成

**字段存储格式详细说明**：

| 字段名           | SQL类型     | 是否必填 | 存储格式                          | 示例值                                         | 说明                           |
| ---------------- | ----------- | -------- | --------------------------------- | ---------------------------------------------- | ------------------------------ |
| `access_id`    | SERIAL      | 自动生成 | 整数，自动递增                    | 1, 2, 3...                                     | 主键，插入时不需要提供         |
| `inspector_id` | INT         | 必填     | 整数，引用inspectors.inspector_id | 1, 2, 3...                                     | 药检员ID，外键，必须已存在     |
| `lab_id`       | INT         | 必填     | 整数，引用laboratories.lab_id     | 1, 2, 3...                                     | 实验室ID，外键，必须已存在     |
| `access_level` | VARCHAR(50) | 可选     | 中文字符串                        | "只读权限", "操作权限", "管理权限", "完全权限" | 权限级别，可为NULL，最大50字符 |
| `granted_date` | DATE        | 可选     | 日期格式：YYYY-MM-DD              | "2018-05-10", "2023-12-20"                     | 授权日期，可为NULL             |

**SQL插入示例**：

```sql
INSERT INTO inspector_lab_access (inspector_id, lab_id, access_level, granted_date)
VALUES (1, 1, '操作权限', '2020-03-15');
```

**注意事项**：

- 必须确保 `inspector_id` 和 `lab_id` 的组合唯一，插入前需检查
- 外键必须引用已存在的药检员和实验室（先执行inspectors和laboratories的插入）
- `access_id` 由数据库自动生成，无需手动设置
- 关系数量应合理，平均每个药检员访问5-6个实验室，每个实验室被20-30个药检员访问

---

## 💬 第三阶段：主要业务数据生成（主要数据源）

### 5. 对话会话表 (conversations)

**目标数量**：约 8,000 条

**数据要求**：

- **会话分配**：
  - 从已生成的150名药检员中随机分配
  - 平均每个药检员约50-80个会话
  - 确保所有药检员都有会话记录
- **会话ID**：使用UUID生成唯一标识符（格式：36字符UUID字符串）
- **会话类型**：从12种类型中按概率随机选择（围绕2025版中国药典四部内容设计）
  - 药材鉴定查询、饮片标准查询、制剂标准查询、化学药品标准查询
  - 生物制品查询、药用辅料查询、通则指导查询、质量标准验证
  - 检测方法咨询、标准解读咨询、实验操作指导、药典更新查询
- **会话主题**：从16个主题中按概率随机选择（基于2025药典四部的具体内容分类）
  - **第一部相关主题**：药材和饮片标准查询、植物油脂提取物标准、成方制剂标准查询、单味制剂标准查询
  - **第二部相关主题**：化学药品标准查询、抗生素标准查询、生化药品标准查询、放射性药品标准查询
  - **第三部相关主题**：生物制品标准查询、疫苗标准查询、通则标准查询、指导原则查询
  - **第四部相关主题**：通用技术要求查询、药用辅料标准查询、制剂通则查询、检验方法查询
- **类型与主题关联**：
  - 使用概率映射确保会话类型和主题的逻辑关联
  - 例如："药材鉴定查询"有60%概率匹配"药材和饮片标准查询"
  - 例如："化学药品标准查询"有50%概率匹配"化学药品标准查询"
  - 例如："检测方法咨询"有50%概率匹配"检验方法查询"
- **时间范围**：2023-2025年，随机生成开始时间
- **会话时长**：开始后5-30分钟随机生成结束时间
- **消息总数**：初始为0，在生成消息后更新

**字段存储格式详细说明**：

| 字段名              | SQL类型      | 是否必填 | 存储格式                          | 示例值                                                   | 说明                                |
| ------------------- | ------------ | -------- | --------------------------------- | -------------------------------------------------------- | ----------------------------------- |
| `conversation_id` | SERIAL       | 自动生成 | 整数，自动递增                    | 1, 2, 3...                                               | 主键，插入时不需要提供              |
| `inspector_id`    | INT          | 必填     | 整数，引用inspectors.inspector_id | 1, 2, 3...                                               | 药检员ID，外键，必须已存在          |
| `session_id`      | VARCHAR(100) | 必填     | UUID字符串，36字符                | "550e8400-e29b-41d4-a716-446655440000"                   | 会话唯一标识，必须唯一，最大100字符 |
| `start_time`      | TIMESTAMP    | 必填     | 时间戳格式：YYYY-MM-DD HH:MM:SS   | "2023-05-15 14:30:00"                                    | 会话开始时间，不能为空              |
| `end_time`        | TIMESTAMP    | 可选     | 时间戳格式：YYYY-MM-DD HH:MM:SS   | "2023-05-15 14:45:00"                                    | 会话结束时间，可为NULL              |
| `total_messages`  | INT          | 可选     | 整数，默认0                       | 0, 12, 15                                                | 消息总数，默认0，生成消息后更新     |
| `session_type`    | VARCHAR(50)  | 可选     | 中文字符串                        | "药材鉴定查询", "化学药品标准查询", "检测方法咨询"       | 会话类型，可为NULL，最大50字符      |
| `context_topic`   | VARCHAR(200) | 可选     | 中文字符串                        | "药材和饮片标准查询", "化学药品标准查询", "检验方法查询" | 会话主题，可为NULL，最大200字符     |

**SQL插入示例**：

```sql
INSERT INTO conversations (inspector_id, session_id, start_time, end_time, total_messages, session_type, context_topic)
VALUES (1, '550e8400-e29b-41d4-a716-446655440000', '2023-05-15 14:30:00', '2023-05-15 14:45:00', 0, '药材鉴定查询', '药材和饮片标准查询');
```

**注意事项**：

- `session_id` 必须唯一，使用UUID生成（格式：550e8400-e29b-41d4-a716-446655440000）
- 外键 `inspector_id` 必须引用已存在的药检员（先执行inspectors的插入）
- `conversation_id` 由数据库自动生成，无需手动设置
- `total_messages` 初始为0，生成消息后需要更新
- 会话类型和主题使用概率随机生成，确保逻辑关联和真实性
- 这是生成消息数据的基础

---

### 6. 对话消息表 (messages) ⭐ **主要数据源**

**目标数量**：约 100,000 条

**数据要求**：

- **消息分配策略**：
  - 为每个已生成的会话生成消息
  - 每个会话平均生成10-15条消息（范围可设置为8-18条）
  - 计算：8,000会话 × 12.5条消息 ≈ 100,000条消息
- **消息序号**：从1开始递增，每个会话独立编号
- **发送者类型**：
  - 奇数序号：`inspector`（药检员发送）
  - 偶数序号：`system`（系统回复）
  - 确保对话的交替模式
- **消息内容生成**：
  - **药检员消息（问题）**：
    - 根据会话主题生成相应的问题模板
    - 问题模板包含药品名称占位符，从药典条目中随机选择药品名称填充
    - 意图分类：从10种意图中随机选择（查询标准、获取信息、核实标准、提出问题等）
  - **系统消息（回答）**：
    - 根据会话主题和引用的药典条目生成回答
    - 回答模板包含药品名称、卷号、文档ID等信息
    - 意图固定为"提供信息"
    - 置信度：0.85-0.99之间随机生成（保留4位小数）
    - 响应时间：50-500毫秒之间随机生成
- **药典条目引用**：
  - 系统消息有70-80%的概率引用药典条目
  - 从已生成的药典条目中随机选择
  - 设置 `referenced_item_id` 字段
- **时间戳**：
  - 根据消息序号递增生成时间戳
  - 确保时间顺序合理

> ***如果要qwen-flash生成数据的话，得实现并发生成和插入，提高速度。***

**字段存储格式详细说明**：

| 字段名                 | SQL类型      | 是否必填 | 存储格式                                | 示例值                             | 说明                                 |
| ---------------------- | ------------ | -------- | --------------------------------------- | ---------------------------------- | ------------------------------------ |
| `message_id`         | SERIAL       | 自动生成 | 整数，自动递增                          | 1, 2, 3...                         | 主键，插入时不需要提供               |
| `conversation_id`    | INT          | 必填     | 整数，引用conversations.conversation_id | 1, 2, 3...                         | 所属会话ID，外键，必须已存在         |
| `message_seq`        | INT          | 必填     | 整数，从1开始递增                       | 1, 2, 3, 4...                      | 消息序号，每个会话独立编号           |
| `sender_type`        | VARCHAR(20)  | 必填     | 字符串，固定值                          | "inspector", "system"              | 发送者类型，必须为这两个值之一       |
| `message_text`       | TEXT         | 必填     | 文本字符串，无长度限制                  | "请问人参的药典标准是什么？"       | 消息内容，不能为空                   |
| `intent`             | VARCHAR(100) | 可选     | 中文字符串                              | "查询标准", "获取信息", "提供信息" | 意图分类，可为NULL，最大100字符      |
| `confidence_score`   | DECIMAL(5,4) | 可选     | 小数，4位小数，范围0.0000-0.9999        | 0.8500, 0.9234, 0.9876             | 识别置信度，可为NULL，仅系统消息使用 |
| `response_time_ms`   | INT          | 可选     | 整数，单位毫秒                          | 50, 150, 300, 500                  | 响应时间，可为NULL，仅系统消息使用   |
| `referenced_item_id` | INT          | 可选     | 整数，引用pharmacopoeia_items.item_id   | 1, 2, 3...                         | 关联的药典条目ID，外键，可为NULL     |
| `timestamp`          | TIMESTAMP    | 自动生成 | 时间戳格式：YYYY-MM-DD HH:MM:SS         | "2023-05-15 14:30:15"              | 消息时间戳，默认当前时间             |

**SQL插入示例**：

```sql
-- 药检员消息
INSERT INTO messages (conversation_id, message_seq, sender_type, message_text, intent, timestamp)
VALUES (1, 1, 'inspector', '请问人参的药典标准是什么？', '查询标准', '2023-05-15 14:30:00');

-- 系统消息
INSERT INTO messages (conversation_id, message_seq, sender_type, message_text, intent, confidence_score, response_time_ms, referenced_item_id, timestamp)
VALUES (1, 2, 'system', '根据药典记录，人参的药典标准为...', '提供信息', 0.9234, 150, 1, '2023-05-15 14:30:15');
```

**注意事项**：

- 这是系统的**主要数据源**，必须达到10万条以上
- 外键 `conversation_id` 必须引用已存在的会话（先执行conversations的插入）
- 外键 `referenced_item_id` 可以为空（药检员消息通常不引用），如引用则必须已存在
- `message_id` 和 `timestamp` 由数据库自动生成，无需手动设置
- `sender_type` 必须为 "inspector" 或 "system"
- `confidence_score` 和 `response_time_ms` 通常仅系统消息使用
- 生成后需要更新对应会话的 `total_messages` 字段

---

## 🔬 第四阶段：辅助业务数据生成（第二数据源）

### 7. 实验记录表 (experiment_records)

**目标数量**：约 15,000 条

**数据要求**：

- **实验分配**：
  - 从已生成的150名药检员中随机分配
  - 从已生成的30个实验室中随机分配
  - 从已生成的6,000个药典条目中随机选择检测药品
  - 平均每个药检员约100个实验，每个实验室约500个实验
- **实验编号格式**：`EXP-{年份}{月份}-{字母}{序号}`
  - 年份：2023-2025
  - 月份：01-12
  - 字母：A-Z随机
  - 序号：001-999
  - 示例：EXP-202504-A001
- **实验类型**：从15种类型中随机选择
  - 含量测定、溶出度测定、水分测定、重金属检查、微生物限度检查
  - 无菌检查、浸出物测定、杂质检查、有关物质检查、残留溶剂测定
  - pH值测定、粒度分析、不溶性微粒检查、装量差异测定、热原检查
- **批号格式**：`B{年份}{月份}{日期}-{序号}`
  - 示例：B20250501-001
- **样品量**：0.5-100.0之间随机生成（保留3位小数）
- **实验日期**：2023-2025年，随机生成
- **实验时间**：
  - 开始时间：实验日期的8:00-17:00之间随机
  - 结束时间：开始后1-4小时随机生成
- **实验状态**：从3种状态中随机选择
  - 进行中：没有结束时间，结果为"待定"
  - 已完成：有结束时间，结果为"合格"/"不合格"/"待定"随机
  - 异常终止：有结束时间，结果为"待定"/"不合格"随机
- **实验结果**：根据状态决定
  - 进行中：固定为"待定"
  - 已完成：从"合格"、"不合格"、"待定"中随机
  - 异常终止：从"待定"、"不合格"中随机
- **实验结论**：
  - 合格：生成标准合格结论文本
  - 不合格：生成包含不合格原因（含量不足、溶出度不达标、杂质超标、微生物超标）的结论文本
  - 其他状态：可以为空

**字段存储格式详细说明**：

| 字段名              | SQL类型       | 是否必填 | 存储格式                                    | 示例值                                 | 说明                                 |
| ------------------- | ------------- | -------- | ------------------------------------------- | -------------------------------------- | ------------------------------------ |
| `experiment_id`   | SERIAL        | 自动生成 | 整数，自动递增                              | 1, 2, 3...                             | 主键，插入时不需要提供               |
| `experiment_no`   | VARCHAR(100)  | 必填     | 字符串，格式：EXP-{年份}{月份}-{字母}{序号} | "EXP-202504-A001"                      | 实验编号，必须唯一，最大100字符      |
| `inspector_id`    | INT           | 必填     | 整数，引用inspectors.inspector_id           | 1, 2, 3...                             | 药检员ID，外键，必须已存在           |
| `lab_id`          | INT           | 必填     | 整数，引用laboratories.lab_id               | 1, 2, 3...                             | 实验室ID，外键，必须已存在           |
| `item_id`         | INT           | 必填     | 整数，引用pharmacopoeia_items.item_id       | 1, 2, 3...                             | 检测的药品ID，外键，必须已存在       |
| `experiment_type` | VARCHAR(100)  | 可选     | 中文字符串                                  | "含量测定", "溶出度测定", "水分测定"   | 实验类型，可为NULL，最大100字符      |
| `batch_no`        | VARCHAR(100)  | 可选     | 字符串，格式：B{年份}{月份}{日期}-{序号}    | "B20250501-001"                        | 批号，可为NULL，最大100字符          |
| `sample_quantity` | DECIMAL(10,3) | 可选     | 小数，3位小数，范围0.500-100.000            | 10.500, 25.750, 50.000                 | 样品量，可为NULL                     |
| `experiment_date` | DATE          | 必填     | 日期格式：YYYY-MM-DD                        | "2023-05-15", "2024-12-20"             | 实验日期，不能为空                   |
| `start_time`      | TIMESTAMP     | 可选     | 时间戳格式：YYYY-MM-DD HH:MM:SS             | "2023-05-15 09:30:00"                  | 实验开始时间，可为NULL               |
| `end_time`        | TIMESTAMP     | 可选     | 时间戳格式：YYYY-MM-DD HH:MM:SS             | "2023-05-15 12:30:00"                  | 实验结束时间，可为NULL（进行中实验） |
| `status`          | VARCHAR(50)   | 可选     | 中文字符串                                  | "进行中", "已完成", "异常终止"         | 实验状态，可为NULL，最大50字符       |
| `result`          | VARCHAR(50)   | 可选     | 中文字符串                                  | "合格", "不合格", "待定"               | 实验结果，可为NULL，最大50字符       |
| `conclusion`      | TEXT          | 可选     | 文本字符串，无长度限制                      | "实验结果符合药典标准要求，样品合格。" | 实验结论，可为NULL                   |
| `created_at`      | TIMESTAMP     | 自动生成 | 时间戳格式：YYYY-MM-DD HH:MM:SS             | "2025-01-15 10:30:00"                  | 创建时间，默认当前时间               |

**SQL插入示例**：

```sql
INSERT INTO experiment_records (experiment_no, inspector_id, lab_id, item_id, experiment_type, batch_no, sample_quantity, experiment_date, start_time, end_time, status, result, conclusion)
VALUES ('EXP-202504-A001', 1, 1, 1, '含量测定', 'B20250501-001', 10.500, '2023-05-15', '2023-05-15 09:30:00', '2023-05-15 12:30:00', '已完成', '合格', '实验结果符合药典标准要求，样品合格。');
```

**注意事项**：

- `experiment_no` 必须唯一，插入前需检查
- 所有外键必须引用已存在的数据（inspector_id, lab_id, item_id）
- `experiment_id` 和 `created_at` 由数据库自动生成，无需手动设置
- `end_time` 为NULL表示实验进行中
- `status` 和 `result` 有逻辑关系：进行中→待定，已完成→合格/不合格/待定
- 这是生成实验数据点的基础

---

### 8. 实验数据点表 (experiment_data_points)

**目标数量**：约 40,000 条

**数据要求**：

- **数据点分配**：
  - 为每个已生成的实验记录生成数据点
  - 每个实验记录平均生成2-5个数据点（范围可设置为2-5条）
  - 计算：15,000实验 × 2.67数据点 ≈ 40,000条数据点
- **测量类型选择**：
  - 根据实验类型选择相应的测量类型
  - 例如：含量测定实验 → 主成分含量、杂质含量、对照品含量对比等
  - 例如：溶出度测定实验 → 溶出度、释放度、累积溶出百分比等
  - 每个实验从对应的测量类型列表中随机选择2-5种
- **测量值生成**：
  - 根据测量类型设置合理的数值范围
  - **含量类**：88-112%，标准范围90-110%
  - **杂质类**：0-2.5%，标准范围0-2.0%
  - **水分类**：0-12%，标准范围0-10%
  - **重金属类**：0-15 ppm，标准范围0-10 ppm
  - **pH值**：3-11，标准范围4.0-9.0
  - **溶出度**：65-105%，标准范围75-100%
- **测量单位**：根据测量类型设置相应单位（%、ppm、mg/g、CFU/g等）
- **合格判定**：
  - 根据测量值是否在标准范围内（standard_min ≤ value ≤ standard_max）判定
  - 设置 `is_qualified` 字段
- **测量时间**：实验开始后1-48小时内随机生成
- **设备编号**：从15个设备ID中随机选择
  - HPLC-001、HPLC-002、GC-001、UV-001、IR-001等
- **备注信息**：
  - 不合格的数据点有概率生成备注，说明可能的原因
  - 备注内容：测量值超出标准范围、可能存在操作误差、仪器可能需要校准等

**字段存储格式详细说明**：

| 字段名                | SQL类型       | 是否必填 | 存储格式                                   | 示例值                           | 说明                                 |
| --------------------- | ------------- | -------- | ------------------------------------------ | -------------------------------- | ------------------------------------ |
| `data_id`           | SERIAL        | 自动生成 | 整数，自动递增                             | 1, 2, 3...                       | 主键，插入时不需要提供               |
| `experiment_id`     | INT           | 必填     | 整数，引用experiment_records.experiment_id | 1, 2, 3...                       | 所属实验ID，外键，必须已存在         |
| `measurement_type`  | VARCHAR(100)  | 必填     | 中文字符串                                 | "主成分含量", "溶出度", "pH值"   | 测量类型，不能为空，最大100字符      |
| `measurement_value` | DECIMAL(12,4) | 可选     | 小数，4位小数                              | 95.5000, 7.2500, 0.8500          | 测量值，可为NULL                     |
| `measurement_unit`  | VARCHAR(50)   | 可选     | 字符串                                     | "%", "ppm", "mg/g", ""           | 测量单位，可为NULL，最大50字符       |
| `standard_min`      | DECIMAL(12,4) | 可选     | 小数，4位小数                              | 90.0000, 0.0000, 4.0000          | 标准下限，可为NULL                   |
| `standard_max`      | DECIMAL(12,4) | 可选     | 小数，4位小数                              | 110.0000, 2.0000, 9.0000         | 标准上限，可为NULL                   |
| `is_qualified`      | BOOLEAN       | 可选     | 布尔值：TRUE/FALSE                         | TRUE, FALSE                      | 是否合格，根据值是否在标准范围内判定 |
| `measurement_time`  | TIMESTAMP     | 可选     | 时间戳格式：YYYY-MM-DD HH:MM:SS            | "2023-05-15 10:30:00"            | 测量时间，可为NULL                   |
| `equipment_id`      | VARCHAR(100)  | 可选     | 字符串                                     | "HPLC-001", "GC-001", "UV-001"   | 设备编号，可为NULL，最大100字符      |
| `notes`             | TEXT          | 可选     | 文本字符串，无长度限制                     | "测量值超出标准范围，需重新检测" | 备注，可为NULL                       |

**SQL插入示例**：

```sql
INSERT INTO experiment_data_points (experiment_id, measurement_type, measurement_value, measurement_unit, standard_min, standard_max, is_qualified, measurement_time, equipment_id, notes)
VALUES (1, '主成分含量', 95.5000, '%', 90.0000, 110.0000, TRUE, '2023-05-15 10:30:00', 'HPLC-001', NULL);
```

**注意事项**：

- 外键 `experiment_id` 必须引用已存在的实验记录（先执行experiment_records的插入）
- `data_id` 由数据库自动生成，无需手动设置
- 测量值应具有合理性，符合实际检测场景
- `is_qualified` 应根据 `measurement_value` 是否在 `standard_min` 和 `standard_max` 范围内判定
- 不合格数据点应占一定比例（约10-20%），模拟真实情况
- `measurement_unit` 根据测量类型设置：含量类用"%"，重金属用"ppm"，pH值用空字符串""

---

## 📈 数据量汇总

| 表名                   | 目标数量           | 说明                             | 优先级               |
| ---------------------- | ------------------ | -------------------------------- | -------------------- |
| pharmacopoeia_items    | ~6,000             | 药典条目（基础数据）             | ⭐⭐⭐ 必须          |
| inspectors             | ~150               | 药检员（基础数据）               | ⭐⭐⭐ 必须          |
| laboratories           | ~30                | 实验室（基础数据）               | ⭐⭐⭐ 必须          |
| inspector_lab_access   | ~800               | 权限关系（关联数据）             | ⭐⭐ 重要            |
| conversations          | ~8,000             | 对话会话（业务数据）             | ⭐⭐ 重要            |
| **messages**     | **~100,000** | **对话消息（主要数据源）** | ⭐⭐⭐**核心** |
| experiment_records     | ~15,000            | 实验记录（第二数据源）           | ⭐⭐ 重要            |
| experiment_data_points | ~40,000            | 实验数据点（第二数据源）         | ⭐⭐ 重要            |
| **总计**         | **~170,000** | **满足10万+要求**          | ✅                   |

---

## ⚠️ 数据生成注意事项

### 1. 外键约束

- 所有外键引用的数据必须已存在
- 生成顺序严格按照：基础表 → 关联表 → 业务表
- 删除数据时注意级联删除的影响

### 2. 唯一性约束

- `pharmacopoeia_items`：`(volume, doc_id)` 组合唯一
- `inspectors`：`employee_no` 唯一
- `laboratories`：`lab_code` 唯一
- `conversations`：`session_id` 唯一
- `experiment_records`：`experiment_no` 唯一
- `inspector_lab_access`：`(inspector_id, lab_id)` 组合唯一

### 3. 数据合理性

- 时间字段应保持逻辑一致性（开始时间 < 结束时间）
- 数值字段应在合理范围内
- 文本字段应具有多样性，避免完全重复
- 布尔字段应根据业务逻辑设置

### 4. 性能考虑

- 大批量数据生成应使用批量插入（batch insert）
- 对于10万条消息数据，建议分批生成，每批1000-5000条
- 可以使用事务确保数据一致性，但注意事务大小，避免超时

### 5. 数据分布

- 确保数据在各维度上分布均匀
- 药检员、实验室、药典条目的使用频率应相对均衡
- 时间分布应覆盖整个时间范围（2023-2025）

### 6. 错误处理

- 生成过程中应记录日志
- 遇到唯一性冲突应跳过或重新生成
- 外键引用失败应记录错误并停止相关数据生成

---

## 🎯 数据生成验证

生成完成后，应验证以下内容：

1. **数据量验证**：检查各表记录数是否达到目标
2. **外键完整性**：验证所有外键引用是否有效
3. **唯一性验证**：检查唯一约束字段是否有重复
4. **数据分布验证**：检查数据在各维度上的分布是否合理
5. **关系完整性**：验证1-N和N-M关系是否正确建立

---

## 📝 生成脚本执行建议

1. **首次生成**：按顺序执行所有生成脚本
2. **增量生成**：可以单独执行某个模块的生成脚本
3. **重新生成**：如需重新生成，建议先清空相关表（注意外键约束）
4. **性能监控**：记录各阶段生成耗时，优化批量插入大小

---

## 🔄 数据维护

- 定期备份生成的数据
- 记录数据生成的时间戳和版本信息
- 保持数据生成脚本的可重复执行性
- 考虑数据生成的幂等性（多次执行结果一致）
